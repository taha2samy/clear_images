# ./redis/container-tests.yaml - The Corrected Version
schemaVersion: '2.0.0'

metadataTest:
  # The official Redis image runs as the 'redis' user. This test is correct.
  user: 'redis'
  exposedPorts: ['6379']

# FIX #1: Instead of using the 'which' command, we directly check for the file's existence.
# This is more reliable and doesn't depend on extra tools.
fileExistenceTests:
  - name: 'Redis Server Executable'
    path: '/usr/local/bin/redis-server'
    shouldExist: true
    isExecutableBy: 'owner' # Verify that it can be run

# FIX #2: We combine starting the server AND pinging it in one single, smart test.
commandTests:
  - name: 'Start server and test connection'
    # We use a shell to run multiple commands:
    # 1. Start redis-server in the background (daemonize)
    # 2. Wait 1 second for it to initialize
    # 3. Run the ping command
    command: "sh"
    args: 
      - "-c"
      - "redis-server --daemonize yes && sleep 1 && redis-cli ping"
    # The final output of the whole sequence should contain "PONG"
    expectedOutput: ["PONG"]