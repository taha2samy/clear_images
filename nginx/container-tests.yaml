schemaVersion: '2.0.0'

# This file performs internal, structural checks.
metadataTest:
  # Verify the container runs as the non-root 'nginx' user.
  user: 'nginx'

commandTests:
  # This is the best internal health check for Nginx.
  # 'nginx -t' tests the configuration syntax.
  # It proves the binary works, the config is valid, and it prints the version.
  - name: 'Nginx Configuration and Version Check'
    command: '/usr/sbin/nginx'
    args: ['-t']
    # Nginx prints this info to stderr. We use a regex to match the version.
    expectedError: ['.*nginx version: nginx/1.27\..*configuration file /etc/nginx/nginx.conf test is successful.*']